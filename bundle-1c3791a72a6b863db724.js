(()=>{"use strict";const e={shipsToPlace:[5,4,3,3,2],selectedShip:0,orientation:"x",isPLayerTurn:!0,allShipsPlaced:!1};function t(e){const t=e.getAttribute("coords").replace(/\D/g,"");return Array.from(t,Number)}function s(e,t){const s=JSON.stringify(t).replaceAll(",",", ");return document.querySelector(`#${e} [coords='${s}']`)}function r(){return[Math.floor(10*Math.random()),Math.floor(10*Math.random())]}class a{static createGameboard(e){const t=document.getElementById(e);for(let e=0;e<10;e+=1)for(let s=0;s<10;s+=1){const r=document.createElement("div");r.setAttribute("coords",`[${s}, ${e}]`),r.classList.add("cell"),t.appendChild(r)}}static renderPlayerShips(e){e.forEach((e=>{e.forEach((e=>{const t=s("player-board",e);t.classList.add("ship"),t.classList.remove("hover")}))}))}static animateComputerPlacement(){e.animationFinished=!1;const t=document.getElementById("computer-board");t.setAttribute("data-state","PLACING SHIPS...");let s=0;const r=setInterval((()=>{document.querySelector(`.computer[ship='${s}']`).classList.add("placed"),s+=1,s>4&&(clearInterval(r),t.setAttribute("data-state",""),document.querySelector(".subtitle").innerText="Let the battle begin!",e.animationFinished=!0,t.classList.add("selected"))}),800)}static renderMarkers(e){const t=document.querySelector(".player-marker"),s=document.querySelector(".computer-marker");for(let r=0;r<2;r+=1)for(let a=0;a<e.length;a+=1){const i=document.createElement("div");i.classList.add("ship-marker"),r?i.classList.add("computer"):i.classList.add("player");for(let t=0;t<e[a];t+=1){const e=document.createElement("div");i.setAttribute("ship",a),i.appendChild(e)}r?s.appendChild(i):t.appendChild(i)}}static renderHoverEffect(s,r,a,i){if(!e.allShipsPlaced){const e=t(s);if("x"===a&&e[0]+r>10)return;if("y"===a&&e[1]+r>10)return;for(let t=0;t<r;t+=1){let s;s="x"===a?[e[0]+t,e[1]]:[e[0],e[1]+t];const r=JSON.stringify(s).replaceAll(",",", "),c=document.querySelector(`[coords='${r}']`);i&&c.classList.add("hover"),i||c.classList.remove("hover")}}}static removeHoverEffect(){document.querySelectorAll(".cell.hover").forEach((e=>{e.classList.remove("hover")}))}static renderHit(e){e.classList.add("hit")}static renderWater(e){e.classList.add("water")}static selectMarker(e){this.removeMarkerSelection(),e.classList.add("selected")}static renderMarker(e){document.querySelector(`.player[ship='${e}']`).classList.add("placed")}static removeMarkerSelection(){document.querySelectorAll(".selected").forEach((e=>{e.classList.remove("selected")}))}}class i{static player;static computer;static placeComputerShips(){for(;this.computer.placedShips<e.shipsToPlace.length;){const t=e.shipsToPlace[this.computer.placedShips],s=Math.random()<.5?"x":"y",a=r();this.computer.gameboard.placeShip(t,s,a)}}static placeShip(s){if(!e.allShipsPlaced){const r=e.shipsToPlace[e.selectedShip],i=t(s),c=this.player.placeShip(r,e.orientation,i);document.querySelector(".subtitle").innerText="",this.player.placedShips===e.shipsToPlace.length&&(e.allShipsPlaced=!0,a.animateComputerPlacement()),a.renderPlayerShips(this.player.gameboard.shipsCoords),c&&(a.renderMarker(e.selectedShip),this.selectNextShip())}}static changeOrientation(){"x"===e.orientation?e.orientation="y":e.orientation="x"}static selectNextShip(){if(this.player.placedShips!==e.shipsToPlace.length)for(let t=1;t<=e.shipsToPlace.length;t+=1){let s=e.selectedShip+t;if(s>=e.shipsToPlace.length&&(s=t-1),!document.querySelector(`.player[ship='${s}']`).classList.contains("placed"))return void this.selectShip(s)}else a.removeMarkerSelection()}static selectShip(t){if("number"==typeof t){const s=document.querySelector(`.player[ship='${t}']`);e.selectedShip=t,a.selectMarker(s)}else{const s=parseInt(t.getAttribute("ship"),10);e.selectedShip=s,a.selectMarker(t)}}static makePlayerPlay(s){if(e.allShipsPlaced&&e.isPLayerTurn&&e.animationFinished){const r=t(s);if(s.classList.contains("water"))return;if(s.classList.contains("hit"))return;this.computer.gameboard.receiveAttack(r)?a.renderHit(s):a.renderWater(s),e.isPLayerTurn=!1,document.getElementById("computer-board").classList.remove("selected"),document.getElementById("player-board").classList.add("selected"),setTimeout(this.makeComputerPlay,600)}}static makeComputerPlay(){const t=r(),c=s("player-board",t);i.player.gameboard.receiveAttack(t)?a.renderHit(c):a.renderWater(c),e.isPLayerTurn=!0,document.getElementById("player-board").classList.remove("selected"),document.getElementById("computer-board").classList.add("selected")}}class c{constructor(e){this.length=e,this.hits=[]}hit(e){this.hits.push(e)}isSunk(){return this.hits.length===this.length}}class o{constructor(){this.ships=[],this.shipsCoords=[],this.missed=[],console.log("this.ships: ",this.ships)}placeShip(e,t,s){const r=o.getFullCoords(e,t,s);if(this.isPossible(r)){const t=new c(e);return this.ships.push(t),this.shipsCoords.push(r),!0}return!1}isPossible(e){const t=JSON.stringify(this.shipsCoords);for(let s=0;s<e.length;s+=1){const r=JSON.stringify(e[s]);if(t.includes(r)||r.includes("10"))return!1}return!0}static getFullCoords(e,t,s){const r=[];for(let a=0;a<e;a+=1)"x"===t?r.push([s[0]+a,s[1]]):"y"===t&&r.push([s[0],s[1]+a]);return r}receiveAttack(e){for(let t=0;t<this.shipsCoords.length;t+=1)if(JSON.stringify(this.shipsCoords[t]).includes(JSON.stringify(e)))return this.ships[t].hit(e),!0;return this.missed.push(e),!1}isEveryShipSunk(){for(let e=0;e<this.ships.length;e+=1)if(!this.ships[e].isSunk())return!1;return!0}}class l{constructor(){this.gameboard=new o}placeShip(e,t,s){return this.gameboard.placeShip(e,t,s)}get placedShips(){return this.gameboard.ships.length}}class n{static gameboard(){document.getElementById("player-board").addEventListener("click",(e=>{e.target.classList.contains("cell")&&i.placeShip(e.target)})),document.getElementById("computer-board").addEventListener("click",(e=>{e.target.classList.contains("cell")&&i.makePlayerPlay(e.target)})),document.addEventListener("contextmenu",(t=>{t.preventDefault(),i.changeOrientation(),a.removeHoverEffect(),a.renderHoverEffect(t.target,e.shipsToPlace[e.selectedShip],e.orientation,!0)})),document.querySelectorAll("#player-board .cell").forEach((t=>{t.addEventListener("mouseover",(t=>{a.renderHoverEffect(t.target,e.shipsToPlace[e.selectedShip],e.orientation,!0)})),t.addEventListener("mouseout",(t=>{a.renderHoverEffect(t.target,e.shipsToPlace[e.selectedShip],e.orientation,!1)}))}))}static markers(){document.querySelectorAll(".ship-marker.player").forEach((e=>{e.addEventListener("click",(e=>{e.target.parentElement.classList.contains("placed")||i.selectShip(e.target.parentElement)}))}))}}i.player=new l,i.computer=new l,i.placeComputerShips(),a.createGameboard("player-board"),a.createGameboard("computer-board"),a.renderPlayerShips(i.player.gameboard.shipsCoords),a.renderMarkers(e.shipsToPlace),i.selectShip(0),n.gameboard(),n.markers()})();